<Window x:Class="RestBox.Shell"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:avalondock="http://avalondock.codeplex.com"
        xmlns:UserControls="clr-namespace:RestBox.UserControls"
        xmlns:Properties="clr-namespace:AvalonDock.Properties;assembly=AvalonDock" Title="{Binding ApplicationTitle}" Height="600" Width="800" WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />            
        </Grid.RowDefinitions>

        <Menu Grid.Row="0" ItemsSource="{Binding MenuItems}" />
        <StatusBar DockPanel.Dock="Bottom" x:Name="StatusBar" Height="35" VerticalAlignment="Bottom" Grid.Row="2">
            <Label Content="Ready" />
        </StatusBar>
        
        <avalondock:DockingManager x:Name="dockingManager" Grid.Row="1">

            <avalondock:DockingManager.DocumentContextMenu>
                <ContextMenu>
                    <MenuItem Header="{x:Static Properties:Resources.Document_Close}" 
                     Command="{Binding Path=CloseCommand}"
                     Visibility="{Binding Path=IsEnabled, RelativeSource={RelativeSource Self}, Mode=OneWay}"/>
                    <MenuItem Header="{x:Static Properties:Resources.Document_CloseAllButThis}" 
                     Command="{Binding Path=CloseAllButThisCommand}"/>
                </ContextMenu>
            </avalondock:DockingManager.DocumentContextMenu>

            <avalondock:LayoutRoot>
                <avalondock:LayoutPanel Orientation="Horizontal">
                    <avalondock:LayoutDocumentPane x:Name="DocumentsPane">
                        <avalondock:LayoutDocument Title="Start Page" IsActiveChanged="DocumentIsActiveChanged">
                            <TextBox x:Name="StartPageTextBox" Text="Do something with this page" />
                        </avalondock:LayoutDocument>
                    </avalondock:LayoutDocumentPane>

                    <avalondock:LayoutAnchorablePaneGroup DockWidth="300">
                        <avalondock:LayoutAnchorablePane>
                            <avalondock:LayoutAnchorable Title="Http Requests" AutoHideWidth="300"  ToolTip="Http Requests" CanClose="False" CanHide="False">
                                <Grid x:Name="HttpRequestFilesGrid" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Visibility="Visible">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="20"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <Grid Grid.Row="0" HorizontalAlignment="Stretch">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="20" />
                                            <ColumnDefinition Width="20" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Button Grid.Column="0" ToolTip="Create new http request"  Height="20" Width="20" Command="{Binding NewHttpRequestFile}" Visibility="{Binding HttpRequestFileNewOpenVisibility, UpdateSourceTrigger=PropertyChanged}">
                                            <StackPanel>
                                                <Image Source="Images/new-icon.png" />
                                            </StackPanel>
                                        </Button>
                                        <Button Grid.Column="1"  ToolTip="Add existing http request"  Height="20" Width="20" Command="{Binding AddExistingHttpRequestFile}" Visibility="{Binding HttpRequestFileNewOpenVisibility, UpdateSourceTrigger=PropertyChanged}">
                                            <StackPanel>
                                                <Image Source="Images/add-icon.png" />
                                            </StackPanel>
                                        </Button>
                                        <TextBox  Grid.Column="2" Text="{Binding HttpRequestFilesFilter, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding HttpRequestFileNewOpenVisibility}" Height="30"/>

                                    </Grid>

                                    <DataGrid x:Name="HttpRequestFilesDataGrid" Grid.Row="1" AutoGenerateColumns="False" SelectionMode="Single" SelectedItem="{Binding SelectedHttpRequestFile}" ItemsSource="{Binding HttpRequestFilesView}" MouseDoubleClick="ActivateHttpRequestFile"  HorizontalAlignment="Stretch" IsReadOnly="True">
                                        <DataGrid.ContextMenu>
                                            <ContextMenu >
                                                <MenuItem Header="Clone" Command="{Binding CloneHttpRequestFile}"  />
                                                <Separator />
                                                <MenuItem Header="Rename" Command="{Binding RenameHttpRequestFile}"  />
                                                <Separator />
                                                <MenuItem Header="Remove" Command="{Binding RemoveHttpRequestFile}"  />
                                                <MenuItem Header="Delete" Command="{Binding DeleteHttpRequestFile}"  />
                                            </ContextMenu>
                                        </DataGrid.ContextMenu>

                                        <DataGrid.Columns>
                                        <DataGridTemplateColumn Header="Name" Width="2*">                                              
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>

                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="20" />
                                                                <ColumnDefinition Width="*" />
                                                            </Grid.ColumnDefinitions>

                                                            <Image Width="20" Height="20" Grid.Column="0">
                                                                <Image.Style>
                                                                    <Style TargetType="Image">
                                                                        <Setter Property="Source" Value="\Images\httprequest.png" />
                                                                        <Style.Triggers>
                                                                            <DataTrigger Binding="{Binding Icon}" Value="warning">
                                                                                <Setter Property="Source" Value="Images\warning-icon.png" />
                                                                                <Setter Property="ToolTip" Value="File not found" />
                                                                            </DataTrigger>
                                                                        </Style.Triggers>
                                                                    </Style>
                                                                </Image.Style>
                                                            </Image>

                                                            <TextBox LostFocus="RenameHttpRequest" Visibility="{Binding EditableNameVisibility}" Grid.Column="1" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" ToolTip="{Binding RelativeFilePath, UpdateSourceTrigger=PropertyChanged}" HorizontalAlignment="Stretch"/>
                                                            <Label Visibility="{Binding NameVisibility}" Grid.Column="1" Content="{Binding Name, UpdateSourceTrigger=PropertyChanged}" ToolTip="{Binding RelativeFilePath, UpdateSourceTrigger=PropertyChanged}"/>

                                                        </Grid>                                                           
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                        <DataGridTemplateColumn Header="Groups" Width="*">
                                            <DataGridTemplateColumn.CellTemplate>
                                                <DataTemplate>
                                                        <TextBox Text="{Binding Groups, UpdateSourceTrigger=PropertyChanged}" ToolTip="{Binding Groups, UpdateSourceTrigger=PropertyChanged}" TextChanged="UpdateGroupsEvent" />
                                                </DataTemplate>
                                            </DataGridTemplateColumn.CellTemplate>
                                        </DataGridTemplateColumn>
                                    </DataGrid.Columns>
                                </DataGrid>
                                    
                                </Grid>
                            </avalondock:LayoutAnchorable>
                            <avalondock:LayoutAnchorable x:Name="EnvironmentsLayout" Title="Environments" AutoHideWidth="300"  ToolTip="Environments" CanClose="False" CanHide="False">
                                
                            </avalondock:LayoutAnchorable>
                            <avalondock:LayoutAnchorable x:Name="RequestExtensions" Title="Request Extensions" AutoHideWidth="300" ToolTip="Request Extensions" CanClose="False" CanHide="False">
                            </avalondock:LayoutAnchorable>
                        </avalondock:LayoutAnchorablePane>
                    </avalondock:LayoutAnchorablePaneGroup>

                </avalondock:LayoutPanel>
                
            </avalondock:LayoutRoot>
        </avalondock:DockingManager>
    </Grid>
</Window>
